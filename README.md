# 📖 이미지 처리 모듈 서비스 / 프로젝트 소개

이 프로젝트는 이커머스 회사 내부에서 이미지 관련 처리를 돕기 위한 B2B 이미지 처리 모듈입니다. 이 모듈은 다양한 이미지 크기에 대한 유연한 처리를 통해 빠른 이미지 업로드와 조회 기능을 제공하며, 매끄럽고 직관적인 사용자 경험을 목표로 합니다.

---

## 🏗️ 수정 이유

- **업로드 상태 모니터링**: 현재 SSE 방식을 사용하여 다운로드 상태를 알 수 있으나, SSE는 단방향 통신만 가능하여 업로드 실패 시 재시도가 불가능합니다.
- **MinIO 접근 횟수 최적화**: 원본 이미지 업로드 후 변환 및 리사이징 작업 중 5회의 MinIO 접근이 발생합니다.
- **데이터 검증**: 이상한 데이터 접근을 감지할 필요가 있으며, 이를 통해 시스템의 안정성을 높이고자 합니다.
- **이미지 수정 로직 추가**: 고객 요구에 따라 이미지 수정 기능을 추가해야 합니다.

---

## 🏗️ 수정 상세 내용

- **JPEG 압축**: 브라우저별 지원이 일정하지 않은 WebP 대신 JPEG 형식으로 이미지를 압축합니다. JPEG는 자동으로 메타데이터 제거가 가능하므로, 별도의 메타데이터 제거 작업이 필요하지 않습니다.
- **변환 서버 도입**: 업로드 전에 변환 서버에서 메타데이터 제거 및 JPEG 변환을 수행하여, MinIO로의 불필요한 접근을 줄이고 효율성을 높입니다.
- **Redis 캐싱**: 이미지 데이터를 Redis에 캐싱하여 리사이징 서버가 MinIO 대신 Redis에서 이미지를 가져올 수 있도록 설정, 시스템 부하와 지연 시간을 줄입니다.
- **리사이징 이미지 데이터 분리 저장**: 리사이징된 이미지 데이터를 별도의 테이블에 저장하여 확장성과 버전 관리를 개선합니다.
- **매직 넘버 검증**: 파일 확장자 대신 매직 넘버를 사용하여 이미지 파일의 유효성을 검증하고, 이상 데이터를 감지할 수 있도록 했습니다.
- **Kafka를 이용한 업로드 상태 모니터링**: Kafka로 업로드 상태를 실시간으로 모니터링하고, 실패 시 재시도를 자동으로 요청하여 신뢰성을 향상시킵니다.
- **CDN 직접 접근**: URL 서버를 제거하고, CDN이 데이터 서버에 직접 접근하여 이미지를 조회하도록 아키텍처를 단순화했습니다.
- **고화질 원본 이미지 최적화**: 압축된 원본 이미지와 리사이징 이미지는 MinIO에 저장하고, 고화질 원본 이미지는 별도 클라우드 스토리지에 저장하여 이커머스에서 불필요한 고화질 다운로드 로직을 제거했습니다.

---

## 🏗️ 수정 후 기대 효과

- **MinIO 접근 횟수 감소**: 리사이징 작업 시 MinIO 접근이 기존 5회에서 1회로 줄어듭니다.
- **데이터 검증 강화**: 매직 넘버 검증을 통해 비정상적 데이터 접근을 감지할 수 있습니다.
- **업로드 실패 시 재시도 가능**: Kafka를 통해 업로드 실패 시 자동으로 재업로드 요청을 실행할 수 있습니다.
- **동기화된 이미지 데이터 제공**: 이미지 수정 시 캐싱된 데이터도 동기화하여 최신 데이터를 제공합니다.

---

## 🏗️ 인프라 설계도

### 기존 인프라 설계도

<img width="550" alt="image" src="https://github.com/user-attachments/assets/a482a794-c114-43ce-9616-a65bf102678b">


### 수정된 인프라 설계도

<img width="550" alt="image" src="https://github.com/user-attachments/assets/d43eafa5-9c64-440c-a2d9-2599bd5dc924">


---

## 🔑 주요 기능

### 1️⃣ Image Convert Server
- **확장자 체크**
- **이미지 메타데이터 제거**
- **이미지 JPEG 파일 변환**

### 2️⃣ Image Upload Server
- **이미지 업로드**
- **이미지 정보 DB 저장 (원본 이름, 확장자 등)**
- **이미지 캐싱 처리**

### 3️⃣ Image Resizing Server
- **이미지 리사이징**
- **리사이징된 이미지 정보 DB 저장**
- **리사이징 이미지 업로드**

### 4️⃣ CDN Server
- **브라우저의 이미지 조회 요청 처리**
- **이미지 캐싱 처리**
- **CDN 서버 용량 체크**

---

## ⚙️ 적용 기술

![기술 스택 이미지](https://github.com/user-attachments/assets/7ecff12a-3bdf-46ff-ba60-4020224089a1)

---

이 프로젝트는 최적화된 이미지 관리로 사용자 경험을 개선하고, 안정적인 데이터 처리를 통해 이커머스 회사 내부에서 효율적인 이미지 처리를 제공합니다.
